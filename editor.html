<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Beatmap Editor</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: #282c34; color: #fff;
            padding: 20px;
            max-width: 800px;
            margin: auto; 
        }
        h1, h2 { color: #61dafb; }
        input, button {
            font-size: 1.2em;
            padding: 10px;
            margin: 5px;
            border-radius: 5px;
            border: none;
        }
        button { background: #61dafb; color: #282c34; cursor: pointer; }
        audio { width: 100%; margin-top: 20px; }
        #output {
            width: 100%;
            height: 300px;
            font-family: "Courier New", Courier, monospace;
            background: #21252b;
            color: #98c379;
            margin-top: 20px;
            border: 1px solid #61dafb;
        }
    </style>
</head>
<body>

    <h1>TypoJam Beatmap Editor</h1>

    <h2>1. Load Your Song</h2>
    <input type="file" id="songFile" accept="audio/*">

    <audio id="audioPlayer" controls></audio>

    <h2>2. Create the Map</h2>
    <p>Play the song. When you want a word to appear, type it and press "Map It!" on the beat.</p>
    <input type="text" id="wordInput" placeholder="Type word here...">
    <button id="mapButton">Map It!</button>
    <button id="resetButton" style="background: #e06c75;">Reset</button>

    <h2>3. Your Beatmap (JSON)</h2>
    <p>Copy this and save it as a `.json` file for your game.</p>
    <textarea id="output" readonly></textarea>

    <script>
        const songFileInput = document.getElementById('songFile');
        const audioPlayer = document.getElementById('audioPlayer');
        const wordInput = document.getElementById('wordInput');
        const mapButton = document.getElementById('mapButton');
        const resetButton = document.getElementById('resetButton');
        const outputArea = document.getElementById('output');

        let beatmap = [];


        songFileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const objectURL = URL.createObjectURL(file);
                audioPlayer.src = objectURL;
            }
        });

        mapButton.addEventListener('click', () => {
            const word = wordInput.value;
            if (!word) {
                alert("Please type a word first!");
                return;
            }

            const timestamp = audioPlayer.currentTime;

            const mapEntry = {
                time: timestamp,
                word: word
            };

            beatmap.push(mapEntry);

            beatmap.sort((a, b) => a.time - b.time);

            updateOutput();

            wordInput.value = "";
            wordInput.focus();
        });

        resetButton.addEventListener('click', () => {
            if (confirm("Are you sure you want to clear the entire map?")) {
                beatmap = [];
                updateOutput();
            }
        });

        function updateOutput() {
            outputArea.value = JSON.stringify(beatmap, null, 2);
        }

        wordInput.focus();
    </script>

</body>
</html>